import { describe, expect } from 'vitest';
import { getLoadBarNext } from './getLoadBarNext';
import { nameof } from '@/utils/type/nameof';

describe(nameof({ getLoadBarNext }), (it) => {
	it('should grow from 0 to augmented', () => {
		expect(createLoadBarReport(0)).toMatchInlineSnapshot(`
			{
			  "duration": 21800,
			  "sequence": [
			    0.006666666666666667,
			    0.0132,
			    0.019602666666666668,
			    0.025877280000000003,
			    0.03202640106666667,
			    0.038052539712000004,
			    0.04395815558442667,
			    0.049745659139404805,
			    0.055417412623283376,
			    0.060975731037484375,
			    0.06642288308340136,
			    0.0717610920884,
			    0.07699253691329866,
			    0.08211935284169936,
			    0.08714363245153203,
			    0.09206742646916806,
			    0.09689274460645136,
			    0.101621556380989,
			    0.1062557919200359,
			    0.11079734274830184,
			    0.11524806256000247,
			    0.11960976797546909,
			    0.12388423928262637,
			    0.1280732211636405,
			    0.13217842340703437,
			    0.13620152160556034,
			    0.1401441578401158,
			    0.14400794134998016,
			    0.1477944491896472,
			    0.15150522687252094,
			    0.1551417890017372,
			    0.15870561988836912,
			    0.1621981741572684,
			    0.1656208773407897,
			    0.16897512646064058,
			    0.17226229059809445,
			    0.17548371145279923,
			    0.17864070389040992,
			    0.1817345564792684,
			    0.18476653201634968,
			    0.18773786804268935,
			    0.19064977734850225,
			    0.19350344846819886,
			    0.19630004616550156,
			    0.1990407119088582,
			    0.2017265643373477,
			    0.20435869971726742,
			    0.20693819238958874,
			    0.20946609520846363,
			    0.21194343997096102,
			    0.21437123783820847,
			    0.21675047974811096,
			    0.2190821368198154,
			    0.22136716075008575,
			    0.2236064842017507,
			    0.22580102118438233,
			    0.22795166742736137,
			    0.2300593007454808,
			    0.23212478139723786,
			    0.23414895243595976,
			    0.23613264005390724,
			    0.23807665391949576,
			    0.23998178750777252,
			    0.24184881842428374,
			    0.24367850872246474,
			    0.24547160521468211,
			    0.24722883977705515,
			    0.24895092964818072,
			    0.25063857772188375,
			    0.2522924728341127,
			    0.25391329004409713,
			    0.25550169090988184,
			    0.25705832375835086,
			    0.2585838239498505,
			    0.26007881413752015,
			    0.26154390452143644,
			    0.2629796930976744,
			    0.2643867659023876,
			    0.2657656972510065,
			    0.26711704997265306,
			    0.2684413756398667,
			    0.269739214793736,
			    0.271011097164528,
			    0.2722575418879041,
			    0.27347905771681263,
			    0.274676143229143,
			    0.27584928703122685,
			    0.27699896795726897,
			    0.2781256552647903,
			    0.2792298088261611,
			    0.2803118793163045,
			    0.2813723083966451,
			    0.2824115288953789,
			    0.28342996498413797,
			    0.2844280323511219,
			    0.2854061383707661,
			    0.28636468227001743,
			    0.2873040552912838,
			    0.2882246408521248,
			    0.28912681470174895,
			    0.29001094507438063,
			    0.2908773928395597,
			    0.2917265116494352,
			    0.29255864808311316,
			    0.29337414178811755,
			    0.2941733256190219,
			    0.2949565257733081,
			    0.2957240619245086,
			    0.29647624735268513,
			    0.2972133890722981,
			    0.2979357879575188,
			    0.2986437388650351,
			    0.29933753075440106,
			    0.3000174468059797,
			    0.3006837645365268,
			    0.3013367559124629,
			    0.3019766874608803,
			    0.30260382037832934,
			    0.30321841063742944,
			    0.3038207090913475,
			    0.30441096157618724,
			    0.30498940901133015,
			    0.3055562874977702,
			    0.3061118284144815,
			    0.3066562585128585,
			    0.307189800009268,
			    0.3077126706757493,
			    0.30822508392890097,
			    0.3087272489169896,
			    0.30921937060531646,
			    0.3097016498598768,
			    0.31017428352934595,
			    0.3106374645254257,
			    0.3110913819015838,
			    0.3115362209302188,
			    0.31197216317828114,
			    0.31239938658138217,
			    0.31281806551642116,
			    0.3132283708727594,
			    0.3136304701219709,
			    0.3140245273861981,
			    0.31441070350514083,
			    0.31478915610170466,
			    0.3151600396463372,
			    0.31552350552007713,
			    0.31587970207634225,
			    0.3162287747014821,
			    0.3165708658741191,
			    0.31690611522330336,
			    0.31723465958550395,
			    0.31755663306046056,
			    0.31787216706591803,
			    0.31818139039126636,
			    0.3184844292501077,
			    0.31878140733177224,
			    0.31907244585180344,
			    0.319357663601434,
			    0.319637176996072,
			    0.31991110012281726,
			    0.3201795447870276,
			    0.3204426205579537,
			    0.3207004348134613,
			    0.3209530927838587,
			    0.3212006975948482,
			    0.3214433503096179,
			    0.32168114997009223,
			    0.32191419363735707,
			    0.3221425764312766,
			    0.32236639156931773,
			    0.32258573040459804,
			    0.32280068246317273,
			    0.3230113354805759,
			    0.3232177754376311,
			    0.3234200865955451,
			    0.3236183515303009,
			    0.32381265116636154,
			    0.324003064809701,
			    0.32418967018017364,
			    0.32437254344323685,
			    0.3245517592410388,
			    0.3247273907228847,
			    0.32489950957509367,
			    0.32506818605025845,
			    0.3252334889959199,
			    0.3253954858826682,
			    0.3255542428316815,
			    0.32570982464171455,
			    0.3258622948155469,
			    0.32601171558590264,
			    0.32615814794085124,
			    0.3263016516487009,
			    0.32644228528239355,
			    0.3265801062434123,
			    0.32671517078521073,
			    0.32684753403617317,
			    0.32697725002211636,
			    0.3271043716883407,
			    0.3272289509212406,
			    0.32735103856948244,
			    0.32747068446475947,
			    0.32758793744213094,
			    0.327702845359955,
			    0.32781545511942256,
			    0.3279258126837008,
			    0.32803396309669347,
			    0.32813995050142625,
			    0.3282438181580644,
			    0.3283456084615698,
			    0.32844536295900506,
			    0.32854312236649164,
			    0.3286389265858285,
			    0.3287328147207786,
			    0.3288248250930297,
			    0.32891499525783574,
			    0.3290033620193457,
			    0.32908996144562547,
			    0.3291748288833796,
			    0.3292579989723787,
			    0.32933950565959774,
			  ],
			}
		`);
	});

	it('should grow from 0 to 0.5 to augmented', () => {
		expect(createLoadBarReport(0.5)).toMatchInlineSnapshot(`
			{
			  "duration": 22500,
			  "sequence": [
			    0.028333333333333335,
			    0.05525000000000001,
			    0.08082083333333334,
			    0.10511312500000002,
			    0.12819080208333336,
			    0.15011459531250002,
			    0.17094219888020834,
			    0.19072842226953127,
			    0.20952533448938804,
			    0.22738240109825197,
			    0.2443466143766727,
			    0.2604626169911724,
			    0.27577281947494714,
			    0.29031751183453314,
			    0.30413496957613984,
			    0.31726155443066617,
			    0.3297318100424662,
			    0.3415785528736762,
			    0.35283295856332575,
			    0.3635246439684928,
			    0.3736817451034015,
			    0.3833309911815648,
			    0.3924977749558199,
			    0.4012062195413622,
			    0.4094792418976274,
			    0.4173386131360794,
			    0.42480501581260877,
			    0.4318980983553117,
			    0.43863652677087944,
			    0.4450380337656688,
			    0.4511194654107187,
			    0.45689682547351607,
			    0.4623853175331736,
			    0.4675993849898482,
			    0.47255274907368916,
			    0.477258444953338,
			    0.48172885603900445,
			    0.48597574657038756,
			    0.4900102925752015,
			    0.49384311127977476,
			    0.49748428904911934,
			    0.5009434079299967,
			    0.5042578731047301,
			    0.5075060489759688,
			    0.5106892613297828,
			    0.5138088094365204,
			    0.5168659665811234,
			    0.5198619805828343,
			    0.522798074304511,
			    0.5256754461517541,
			    0.5284952705620524,
			    0.5312586984841446,
			    0.5339668578477951,
			    0.5366208540241725,
			    0.5392217702770223,
			    0.5417706682048152,
			    0.5442685881740522,
			    0.5467165497439045,
			    0.5491155520823597,
			    0.5514665743740459,
			    0.5537705762198983,
			    0.5560284980288337,
			    0.5582412614015904,
			    0.5604097695068919,
			    0.5625349074500874,
			    0.564617542634419,
			    0.566658525115064,
			    0.5686586879460961,
			    0.5706188475205075,
			    0.5725398039034307,
			    0.5744223411586955,
			    0.576267227668855,
			    0.5780752164488112,
			    0.5798470454531683,
			    0.5815834378774383,
			    0.5832851024532228,
			    0.5849527337374917,
			    0.5865870123960751,
			    0.588188605481487,
			    0.5897581667051905,
			    0.5912963367044201,
			    0.592803743303665,
			    0.594281001770925,
			    0.5957287150688398,
			    0.5971474741007964,
			    0.5985378579521138,
			    0.5999004341264048,
			    0.60123575877721,
			    0.6025443769349992,
			    0.6038268227296325,
			    0.6050836196083732,
			    0.6063152805495391,
			    0.6075223082718817,
			    0.6087051954397774,
			    0.6098644248643152,
			    0.6110004697003623,
			    0.6121137936396883,
			    0.6132048511002279,
			    0.6142740874115568,
			    0.615321938996659,
			    0.6163488335500591,
			    0.6173551902123913,
			    0.6183414197414768,
			    0.6193079246799806,
			    0.6202550995197144,
			    0.6211833308626534,
			    0.6220929975787337,
			    0.6229844709604924,
			    0.6238581148746158,
			    0.6247142859104569,
			    0.6255533335255811,
			    0.6263756001884028,
			    0.6271814215179681,
			    0.627971126420942,
			    0.6287450372258565,
			    0.6295034698146728,
			    0.6302467337517126,
			    0.6309751324100117,
			    0.6316889630951448,
			    0.6323885171665752,
			    0.633074080156577,
			    0.6337459318867787,
			    0.6344043465823765,
			    0.6350495929840624,
			    0.6356819344577145,
			    0.6363016291018935,
			    0.6369089298531889,
			    0.6375040845894585,
			    0.6380873362310027,
			    0.6386589228397159,
			    0.639219077716255,
			    0.6397680294952632,
			    0.6403060022386913,
			    0.6408332155272508,
			    0.6413498845500392,
			    0.6418562201923718,
			    0.6423524291218576,
			    0.6428387138727538,
			    0.6433152729286321,
			    0.6437823008033928,
			    0.6442399881206583,
			    0.6446885216915784,
			    0.6451280845910802,
			    0.6455588562325919,
			    0.6459810124412734,
			    0.6463947255257813,
			    0.646800164348599,
			    0.6471974943949603,
			    0.6475868778403945,
			    0.6479684736169199,
			    0.6483424374779149,
			    0.64870892206169,
			    0.6490680769537895,
			    0.649420048748047,
			    0.6497649811064194,
			    0.6501030148176244,
			    0.6504342878546053,
			    0.6507589354308465,
			    0.6510770900555629,
			    0.651388881587785,
			    0.6516944372893626,
			    0.6519938818769087,
			    0.6522873375727039,
			    0.6525749241545831,
			    0.6528567590048248,
			    0.6531329571580616,
			    0.6534036313482338,
			    0.6536688920546024,
			    0.6539288475468438,
			    0.6541836039292402,
			    0.6544332651839888,
			    0.6546779332136423,
			    0.6549177078827028,
			    0.655152687058382,
			    0.6553829666505477,
			    0.6556086406508701,
			    0.655829801171186,
			    0.6560465384810956,
			    0.6562589410448071,
			    0.6564670955572443,
			    0.6566710869794327,
			    0.6568709985731773,
			    0.6570669119350471,
			    0.6572589070296795,
			    0.6574470622224192,
			    0.6576314543113042,
			    0.6578121585584115,
			    0.6579892487205765,
			    0.6581627970794983,
			    0.6583328744712417,
			    0.6584995503151502,
			    0.6586628926421805,
			    0.6588229681226702,
			    0.6589798420935501,
			    0.6591335785850124,
			    0.6592842403466455,
			    0.6594318888730459,
			    0.6595765844289183,
			    0.6597183860736733,
			    0.6598573516855332,
			    0.6599935379851558,
			    0.660127000558786,
			    0.6602577938809436,
			    0.6603859713366581,
			    0.6605115852432583,
			    0.6606346868717264,
			    0.6607553264676252,
			    0.6608735532716061,
			    0.6609894155395073,
			    0.6611029605620505,
			    0.6612142346841429,
			    0.6613232833237933,
			    0.6614301509906507,
			    0.661534881304171,
			    0.6616375170114209,
			    0.6617381000045258,
			    0.6618366713377687,
			    0.6619332712443466,
			    0.662027939152793,
			    0.6621207137030705,
			    0.6622116327623424,
			    0.662300733440429,
			    0.6623880521049537,
			    0.662473624396188,
			    0.6625574852415975,
			    0.662639668870099,
			  ],
			}
		`);
	});
});

function createLoadBarReport(target: number, deltaT = 1000 / 10) {
	const sequence = createLoadBarSequence(target, deltaT);
	return {
		duration: (sequence.length - 1) * deltaT,
		sequence,
	};
}

function createLoadBarSequence(target: number, deltaT = 1000 / 10) {
	const sequence: number[] = [];

	let curr = 0;
	for (;;) {
		const next = getLoadBarNext(target, curr, deltaT);
		sequence.push(next);
		if (curr.toPrecision(4) === next.toPrecision(4)) {
			break;
		}
		curr = next;
	}

	return sequence;
}
